require "colorize"

class ValaCompile
  attr :name
  attr :path, default => "./"

  def initialize(path = "hello")
  end
end

vala_dir = "c:/vala-0.20.1"
valac = "#{vala_dir}/bin/valac"


project_dirs = {
  hello_world: "./hello-world",
  framework: "./Framework",
  game_framework: "GameFramework"
}

task :build_hello do 

  project_name = "hello"
  project_dir = File.absolute_path("./hello-world")

  pkgs = "System Vala.Game.Framework"
  clibs = "System Vala.Game.Framework"

  pkgs = pkgs.split.collect { |x| "--pkg=#{x}" }
  clibs = clibs.split.collect { |x| "--Xcc=-l#{x}" }
  files = FileList["#{project_dir}/**/*.vala"]

  sh "#{valac} --output=#{project_dir}/#{project_name} #{pkgs.join " "} #{clibs.join " "} #{files}"
end

task :build_system do
  puts "-" * 50

  my_class = MyClass.new

  puts my_class.path

  puts "-" * 50

  project_name = "System"
  project_dir = File.absolute_path("./Framework")

  files = FileList["#{project_dir}/System/**/*.vala"]

  sh "#{valac} --output=#{project_dir}/build/#{project_name} #{files}"
end

task :default => [:build_hello, :build_system]